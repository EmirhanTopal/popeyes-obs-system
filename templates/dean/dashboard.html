{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dean/dashboard.css' %}">
{% endblock %}


{% block content %}
<main class="content dean-dashboard">
  <div class="container-fluid py-4">

    <div class="d-flex align-items-center justify-content-between mb-4">
      <h2 class="section-title">Dekan YÃ¶netim Paneli</h2>
      <div class="text-muted">HoÅŸ geldiniz, <strong>{{ username }}</strong></div>
    </div>

    {% if messages %}
      <div class="mb-3">
        {% for m in messages %}
          <div class="alert alert-{{ m.tags }}">{{ m }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- PROGRAM OUTCOMES -->
    <div class="card main-card">
      <div class="card-header bg-primary text-white fw-semibold">
        ğŸ“Š Program Outcomes YÃ¶netimi
      </div>
      <div class="card-body">

        <div class="row g-4 mb-4">
          <div class="col-md-4">
            <div class="stat-card text-center">
              <h5 class="text-success">ğŸ¥ Biyomedikal</h5>
              <h2 class="text-success">{{ biomedical_count }}</h2>
              <small class="text-muted">Outcome</small>
            </div>
          </div>

          <div class="col-md-4">
            <div class="stat-card text-center">
              <h5 class="text-primary">ğŸ’» Bilgisayar</h5>
              <h2 class="text-primary">{{ computer_count }}</h2>
              <small class="text-muted">Outcome</small>
            </div>
          </div>

          <div class="col-md-4">
            <div class="stat-card text-center">
              <h5 class="text-info">ğŸ“Š Toplam</h5>
              <h2 class="text-info">{{ total_count }}</h2>
              <small class="text-muted">Outcome</small>
            </div>
          </div>
        </div>

        <div class="upload-area mb-3">
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row g-3 align-items-end">
              <div class="col-md-4">
                <label class="form-label fw-semibold">Program Tipi</label>
                <select name="program_type" class="form-select">
                  <option value="auto">ğŸ¤– Otomatik AlgÄ±la</option>
                  <option value="biomedical">ğŸ¥ Biyomedikal</option>
                  <option value="computer">ğŸ’» Bilgisayar</option>
                </select>
              </div>

              <div class="col-md-5">
                <label class="form-label fw-semibold">DOCX DosyasÄ±</label>
                <input type="file" name="docx_file" accept=".docx" required class="form-control">
              </div>

              <div class="col-md-3">
                <button class="btn btn-outline-primary w-100 fw-semibold">
                  ğŸš€ YÃ¼kle ve Ä°ÅŸle
                </button>
              </div>
            </div>
          </form>
        </div>

        <div class="text-center">
          <a href="{% url 'dean:program_outcome_list' %}"
             class="btn btn-outline-primary fw-semibold">
            ğŸ“‹ TÃ¼m Outcomes'larÄ± GÃ¶rÃ¼ntÃ¼le
          </a>
        </div>

      </div>
    </div>

    <!-- DEPARTMENTS & STUDENTS -->
    <div class="row g-4">

      <!-- Departments -->
      <div class="col-lg-4">
        <div class="card mini-card">
          <div class="card-header bg-white fw-semibold">ğŸ« BÃ¶lÃ¼mler</div>
          <ul class="list-group list-group-flush">
            <a href="{% url 'dean:student_list' %}" class="list-group-item list-group-item-action">
              ğŸ” TÃ¼m BÃ¶lÃ¼mler
            </a>

            {% for d in departments %}
              <a href="{% url 'dean:student_list' %}?department={{ d.id }}"
                 class="list-group-item list-group-item-action">
                <strong>{{ d.code }}</strong> â€” {{ d.name }}
              </a>
            {% empty %}
              <li class="list-group-item text-muted text-center">KayÄ±t yok</li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <!-- Students -->
      <div class="col-lg-8">
        <div class="card mini-card">
          <div class="card-header bg-white fw-semibold d-flex justify-content-between align-items-center">
            <span>
              ğŸ‘©â€ğŸ“ Ã–ÄŸrenci Listesi
              {% if selected_department %}â€” {{ selected_department.name }}{% endif %}
            </span>

            <form method="get" class="d-flex gap-2">
              {% if selected_department %}
                <input type="hidden" name="department" value="{{ selected_department.id }}">
              {% endif %}
              <input class="form-control form-control-sm" name="q" value="{{ q }}"
                     placeholder="Ä°sim / No ara">
              <button class="btn btn-outline-secondary btn-sm">Ara</button>
            </form>
          </div>

          <div class="table-responsive">
            <table class="table table-fixed mb-0">
              <thead class="table-light">
                <tr>
                  <th>Ã–ÄŸrenci</th>
                  <th>Ã–ÄŸrenci No</th>
                  <th>Departman(lar)</th>
                  <th>PO</th>
                </tr>
              </thead>
              <tbody>
                {% for s in students %}
                  <tr>
                    <td class="fw-semibold">{{ s.full_name }}</td>
                    <td>{{ s.student_no }}</td>
                    <td>
                      {% for d in s.departments.all %}
                        <span class="badge badge-dept me-1">{{ d.code }}</span>
                      {% empty %}-{% endfor %}
                    </td>
                    <td>
                      <a href="{% url 'dean:student_po_report' s.id %}"
                         class="btn btn-outline-primary btn-sm">ğŸ“ˆ</a>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="4" class="text-center text-muted">KayÄ±t yok</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

        </div>
      </div>

    </div>

  </div>
</main>
{% endblock %}
