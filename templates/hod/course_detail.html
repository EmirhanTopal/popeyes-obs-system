{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/hod/course_detail.css' %}">
{% endblock %}

{% block content %}
<main class="content hod-course-detail">
  <div class="container hod-course-detail py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="fw-bold mb-0">
        <a href="{% url 'hod:dashboard' %}"
           class="btn btn-sm btn-light me-2">
          â† Ders Listesi
        </a>
        {{ course.code }} â€” {{ course.name }}
      </h4>

      <a href="{% url 'hod:course_edit' course.id %}"
         class="btn btn-primary btn-sm">
        âœï¸ DÃ¼zenle
      </a>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-info">
          Ders Bilgileri
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-offerings">
          AÃ§Ä±lan Åubeler
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-schedule">
          Ders ProgramÄ±
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-content">
          HaftalÄ±k Ä°Ã§erik
        </button>
      </li>
    </ul>

    <div class="tab-content">

      <!-- ================= TAB 1 : COURSE INFO ================= -->
      <div class="tab-pane fade show active" id="tab-info">
        <div class="tab-card">

          <!-- BASIC INFO -->
          <div class="info-box mb-4">
            <h5 class="fw-semibold mb-3">Temel Bilgiler</h5>

            <div class="row g-3">

              <div class="col-md-6">
                <div class="label">Ders AdÄ±</div>
                <div>{{ course.name }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Kredi</div>
                <div>{{ course.credit }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">AKTS</div>
                <div>{{ course.ects }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Ders TÃ¼rÃ¼</div>
                <div>{{ course.get_course_type_display }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Seviye</div>
                <div>{{ course.level.name }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">DÃ¶nem</div>
                <div>{{ course.semester }}. DÃ¶nem</div>
              </div>

            </div>
          </div>

          <!-- ASSIGNED TEACHERS -->
          <h5 class="fw-semibold mt-4 mb-3">
            Derse Atanan Ã–ÄŸretim GÃ¶revlileri
          </h5>

          {% if assigned_teachers %}
            <ul class="list-group mb-4">
              {% for a in assigned_teachers %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong>{{ a.teacher.full_name }}</strong>
                    <span class="text-muted">
                      â€” {{ a.teacher.get_academic_title_display }}
                    </span><br>
                    <small class="text-muted">
                      {{ a.teacher.department.name }}
                    </small>
                  </div>

                  <span class="badge bg-light text-muted">
                    {{ a.semester }}. DÃ¶nem Â· {{ a.year }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-4">
              Bu derse atanmÄ±ÅŸ Ã¶ÄŸretim gÃ¶revlisi yok.
            </p>
          {% endif %}

          <!-- PREREQUISITES -->
          <div class="info-box">
            <h5 class="fw-semibold mb-3">Ã–nkoÅŸullu Dersler</h5>

            {% if course.prerequisites.all %}
              <ul class="mb-0">
                {% for p in course.prerequisites.all %}
                  <li>{{ p.code }} â€” {{ p.name }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted mb-0">
                Bu dersin Ã¶nkoÅŸulu yok.
              </p>
            {% endif %}
          </div>

        </div>
      </div>

      <!-- ================= TAB 2 : OFFERINGS ================= -->
      <div class="tab-pane fade" id="tab-offerings">
        <div class="tab-card">

          <h5 class="fw-semibold mb-3">AÃ§Ä±lan Åubeler</h5>
          <a href="{% url 'hod:add_offering' course.id %}"
            class="btn btn-sm btn-primary">
                â• Yeni Åube Ekle
          </a>

        

          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>YÄ±l</th>
                  <th>DÃ¶nem</th>
                  <th>Åube</th>
                  <th>Ã–ÄŸretim GÃ¶revlileri</th>
                  <th>Kontenjan</th>
                  <th class="text-end">Ä°ÅŸlemler</th>
                </tr>
              </thead>

              <tbody>
                {% for o in offerings %}
                    <tr>
                        <td>{{ o.year }}</td>
                        <td>{{ o.get_semester_display }}</td>
                        <td>{{ o.section|default:"-" }}</td>
                        <td>
                        {% for t in o.instructors.all %}
                            {{ t.full_name }}<br>
                        {% empty %}
                            <span class="text-muted">Atama yok</span>
                        {% endfor %}
                        </td>
                        <td>{{ o.max_students }}</td>
                        <td class="text-end">
                            <a href="{% url 'hod:edit_offering' o.id %}"
                                class="btn btn-sm btn-outline-primary">
                                âœï¸
                            </a>

                            <a href="{% url 'hod:delete_offering' o.id %}"
                                class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Bu ÅŸubeyi silmek istiyor musunuz?')">
                                    ğŸ—‘ï¸
                            </a>
                        </td>
                  </tr>


                {% empty %}
                  <tr>
                    <td colspan="5" class="text-center text-muted">
                      HenÃ¼z ÅŸube aÃ§Ä±lmamÄ±ÅŸ.
                    </td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
          </div>

        </div>
      </div>

      <!-- ================= TAB 3 : DERS PROGRAMI ================= -->
      <div class="tab-pane fade" id="tab-schedule">

        {% if offerings %}
          {% for offering in offerings %}
            <div class="card mb-3 shadow-sm">

              <!-- ÅUBE BAÅLIÄI -->
              <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <div>
                  <strong>Åube {{ offering.section }}</strong>
                  <span class="text-muted ms-2">
                    ({{ offering.get_semester_display }} â€” {{ offering.year }})
                  </span>
                </div>

                <a href="{% url 'hod:add_schedule' offering.id %}"
                  class="btn btn-sm btn-outline-primary">
                  â• Program Ekle
                </a>
              </div>

              <!-- PROGRAM TABLOSU -->
              <div class="card-body p-0">

                {% if offering.schedules.all %}
                  <div class="table-responsive">
                    <table class="table table-sm mb-0 align-middle">
                      <thead class="table-light">
                        <tr>
                          <th>GÃ¼n</th>
                          <th>Saat</th>
                          <th>Derslik</th>
                          <th class="text-end">Ä°ÅŸlem</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for s in offering.schedules.all %}
                          <tr>
                            <td>{{ s.get_day_display }}</td>
                            <td>{{ s.start_time }} â€“ {{ s.end_time }}</td>
                            <td>{{ s.place|default:"â€”" }}</td>
                            <td class="text-end">
                              <a href="{% url 'hod:edit_schedule' s.id %}"
                                class="btn btn-sm btn-outline-secondary">
                                DÃ¼zenle
                              </a>
                              <a href="{% url 'hod:delete_schedule' s.id %}"
                                class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Bu ders programÄ±nÄ± silmek istiyor musunuz?')">
                                ğŸ—‘ï¸
                              </a>
                            </td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                {% else %}
                  <div class="p-3 text-muted">
                    Bu ÅŸube iÃ§in henÃ¼z ders programÄ± tanÄ±mlanmamÄ±ÅŸ.
                  </div>
                {% endif %}

              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="tab-card text-muted">
            Bu derse ait henÃ¼z ÅŸube bulunmuyor.
          </div>
        {% endif %}

      </div>

      <!-- ================= TAB 4 ================= -->
      <div class="tab-pane fade" id="tab-content">
        <div class="tab-card text-muted">
          HaftalÄ±k iÃ§erik henÃ¼z eklenmedi.
        </div>
      </div>

    </div>

  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}