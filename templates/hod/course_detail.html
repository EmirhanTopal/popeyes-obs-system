{% load static %}

<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <title>{{ course.code }} — {{ course.name }}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f4f6f9; }
        .tab-card { background:white; padding:25px; border-radius:10px; }
        label { font-weight: 600; }
    </style>
</head>

<body class="py-4">
<div class="container">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold">
            <a href="{% url 'hod:dashboard' %}" class="btn btn-sm btn-light me-2">← Ders Listesi</a>
            {{ course.code }} — {{ course.name }}
        </h4>
        <a href="/logout/" class="btn btn-danger btn-sm">Çıkış</a>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#tab-info">Ders Bilgileri</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#tab-offerings">Açılan Şubeler</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#tab-schedule">Ders Programı</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#tab-content">Haftalık İçerik</a>
        </li>
    </ul>

    <div class="tab-content">

        <!-- ========== TAB 1 – COURSE INFO ========== -->
        <div class="tab-pane fade show active" id="tab-info">
            <div class="tab-card">

                <h5 class="mb-3 fw-semibold">Ders Bilgilerini Düzenle</h5>

                <form method="post">
                    {% csrf_token %}

                    <div class="row g-3">

                        <div class="col-md-6">
                            <label>Ders Adı</label>
                            <input type="text" name="name" class="form-control"
                                   value="{{ course.name }}">
                        </div>

                        <div class="col-md-2">
                            <label>Kredi</label>
                            <input type="number" step="0.1" name="credit" class="form-control"
                                   value="{{ course.credit }}">
                        </div>

                        <div class="col-md-2">
                            <label>AKTS</label>
                            <input type="number" step="0.1" name="ects" class="form-control"
                                   value="{{ course.ects }}">
                        </div>

                        <div class="col-md-4">
                            <label>Ders Türü</label>
                            <select name="course_type" class="form-select">
                                {% for val,label in course.COURSE_TYPE_CHOICES %}
                                    <option value="{{ val }}" {% if course.course_type == val %}selected{% endif %}>
                                        {{ label }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label>Önkoşul Dersler</label>
                            <select name="prerequisites" class="form-select" multiple size="5">
                                {% for c in all_courses %}
                                    <option value="{{ c.id }}"
                                            {% if c.id in current_prereq_ids %}selected{% endif %}>
                                        {{ c.code }} — {{ c.name }}
                                    </option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">
                                Ctrl/Cmd ile birden fazla seçebilirsiniz.
                            </small>
                        </div>

                        <div class="col-md-12 mt-3">
                            <button class="btn btn-primary">Kaydet</button>
                            <a href="{% url 'hod:dashboard' %}" class="btn btn-secondary">İptal</a>
                        </div>

                    </div>
                </form>

            </div>
        </div>

        <!-- ========== TAB 2 – OFFERINGS ========== -->
        <div class="tab-pane fade" id="tab-offerings">
            <div class="tab-card">

                <div class="d-flex justify-content-between">
                    <h5 class="fw-semibold mb-3">Açılan Şubeler</h5>

                    <!-- course.id DOĞRU -->
                    <a href="{% url 'hod:add_offering' course.id %}" class="btn btn-success btn-sm">
                        + Yeni Şube Ekle
                    </a>
                </div>

                <table class="table table-striped mt-3">
                    <thead>
                    <tr>
                        <th>Yıl</th>
                        <th>Dönem</th>
                        <th>Şube</th>
                        <th>Öğretim Görevlileri</th>
                        <th>Kontenjan</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>

                    {% for o in offerings %}
                        <tr>
                            <td>{{ o.year }}</td>
                            <td>{{ o.get_semester_display }}</td>
                            <td>{{ o.section|default:"-" }}</td>
                            <td>
                                {% for t in o.instructors.all %}
                                    {{ t.full_name }} <br>
                                {% empty %}
                                    <span class="text-muted">Atama yok</span>
                                {% endfor %}
                            </td>
                            <td>{{ o.max_students }}</td>
                            <td>
                                <a href="{% url 'hod:offering_detail' o.id %}"
                                   class="btn btn-sm btn-primary">Detay</a>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="6" class="text-center text-muted">Henüz şube açılmamış.</td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>

            </div>
        </div>

        <!-- ========== TAB 3 ve TAB 4 Boş Bırakıldı (ama yapısı hazır) ========== -->

    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
