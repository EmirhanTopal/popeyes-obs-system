{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/hod/course_detail.css' %}">
{% endblock %}

{% block content %}
<main class="content hod-course-detail">
  <div class="container hod-course-detail py-4">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="fw-bold mb-0">
        <a href="{% url 'hod:dashboard' %}"
           class="btn btn-sm btn-light me-2">
          ← Ders Listesi
        </a>
        {{ course.code }} — {{ course.name }}
      </h4>

      <a href="{% url 'hod:course_edit' course.id %}"
         class="btn btn-primary btn-sm">
        ✏️ Düzenle
      </a>
    </div>

    <!-- TABS -->
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-info">
          Ders Bilgileri
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-offerings">
          Açılan Şubeler
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-schedule">
          Ders Programı
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-content">
          Haftalık İçerik
        </button>
      </li>
    </ul>

    <div class="tab-content">

      <!-- ================= TAB 1 : COURSE INFO ================= -->
      <div class="tab-pane fade show active" id="tab-info">
        <div class="tab-card">

          <!-- BASIC INFO -->
          <div class="info-box mb-4">
            <h5 class="fw-semibold mb-3">Temel Bilgiler</h5>

            <div class="row g-3">

              <div class="col-md-6">
                <div class="label">Ders Adı</div>
                <div>{{ course.name }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Kredi</div>
                <div>{{ course.credit }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">AKTS</div>
                <div>{{ course.ects }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Ders Türü</div>
                <div>{{ course.get_course_type_display }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Seviye</div>
                <div>{{ course.level.name }}</div>
              </div>

              <div class="col-md-3">
                <div class="label">Dönem</div>
                <div>{{ course.semester }}. Dönem</div>
              </div>

            </div>
          </div>

          <!-- ASSIGNED TEACHERS -->
          <h5 class="fw-semibold mt-4 mb-3">
            Derse Atanan Öğretim Görevlileri
          </h5>

          {% if assigned_teachers %}
            <ul class="list-group mb-4">
              {% for a in assigned_teachers %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <div>
                    <strong>{{ a.teacher.full_name }}</strong>
                    <span class="text-muted">
                      — {{ a.teacher.get_academic_title_display }}
                    </span><br>
                    <small class="text-muted">
                      {{ a.teacher.department.name }}
                    </small>
                  </div>

                  <span class="badge bg-light text-muted">
                    {{ a.semester }}. Dönem · {{ a.year }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-4">
              Bu derse atanmış öğretim görevlisi yok.
            </p>
          {% endif %}

          <!-- PREREQUISITES -->
          <div class="info-box">
            <h5 class="fw-semibold mb-3">Önkoşullu Dersler</h5>

            {% if course.prerequisites.all %}
              <ul class="mb-0">
                {% for p in course.prerequisites.all %}
                  <li>{{ p.code }} — {{ p.name }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-muted mb-0">
                Bu dersin önkoşulu yok.
              </p>
            {% endif %}
          </div>

        </div>
      </div>

      <!-- ================= TAB 2 : OFFERINGS ================= -->
      <div class="tab-pane fade" id="tab-offerings">
        <div class="tab-card">

          <h5 class="fw-semibold mb-3">Açılan Şubeler</h5>

          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Yıl</th>
                  <th>Dönem</th>
                  <th>Şube</th>
                  <th>Öğretim Görevlileri</th>
                  <th>Kontenjan</th>
                </tr>
              </thead>
              <tbody>

                {% for o in offerings %}
                  <tr>
                    <td>{{ o.year }}</td>
                    <td>{{ o.get_semester_display }}</td>
                    <td>{{ o.section|default:"-" }}</td>
                    <td>
                      {% for t in o.instructors.all %}
                        {{ t.full_name }}<br>
                      {% empty %}
                        <span class="text-muted">Atama yok</span>
                      {% endfor %}
                    </td>
                    <td>{{ o.max_students }}</td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="5" class="text-center text-muted">
                      Henüz şube açılmamış.
                    </td>
                  </tr>
                {% endfor %}

              </tbody>
            </table>
          </div>

        </div>
      </div>

      <!-- ================= TAB 3 ================= -->
      <div class="tab-pane fade" id="tab-schedule">
        <div class="tab-card text-muted">
          Program özelliği henüz eklenmedi.
        </div>
      </div>

      <!-- ================= TAB 4 ================= -->
      <div class="tab-pane fade" id="tab-content">
        <div class="tab-card text-muted">
          Haftalık içerik henüz eklenmedi.
        </div>
      </div>

    </div>

  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}